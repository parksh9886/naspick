<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G2HLEL6YBR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-G2HLEL6YBR');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Best Stocks to Buy Today | AI Stock Ratings & Analysis - NASPICK</title>
    <meta name="description"
        content="Discover top-rated S&P 500 stocks with AI-powered analysis. Real-time stock rankings, price targets, and quantitative ratings. Updated every 15 minutes.">
    <!-- Brand Assets -->
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <link rel="canonical" href="https://naspick.com/en/">
    <link rel="alternate" hreflang="en" href="https://naspick.com/en/">
    <link rel="alternate" hreflang="ko" href="https://naspick.com/">
    <link rel="alternate" hreflang="x-default" href="https://naspick.com/en/">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="NASPICK">
    <meta property="og:title" content="Best Stocks to Buy Today | AI Stock Ratings - NASPICK">
    <meta property="og:description"
        content="AI-powered S&P 500 stock analysis. Discover today's top-rated picks and price forecasts.">
    <meta property="og:url" content="https://naspick.com/en/">
    <meta property="og:image" content="https://naspick.com/images/og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Best Stocks to Buy Today | AI Stock Ratings - NASPICK">
    <meta name="twitter:description" content="AI-powered S&P 500 stock rankings. Find today's top picks.">
    <meta name="twitter:image" content="https://naspick.com/images/og-image.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* Scrollbar behaviors */
        @media (max-width: 768px) {
            .mobile-no-scrollbar::-webkit-scrollbar {
                display: none;
            }

            .mobile-no-scrollbar {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        }

        @media (min-width: 769px) {
            .pc-scrollbar::-webkit-scrollbar {
                height: 8px;
                /* Height for horizontal scrollbar */
                width: 8px;
                /* Width for vertical scrollbar */
            }

            .pc-scrollbar::-webkit-scrollbar-track {
                background: transparent;
                /* Transparent track like the image */
            }

            .pc-scrollbar::-webkit-scrollbar-thumb {
                background: #808080;
                /* Neutral gray like the image */
                border-radius: 4px;
                /* Rounded corners */
            }

            .pc-scrollbar::-webkit-scrollbar-thumb:hover {
                background: #a0a0a0;
                /* Lighter on hover */
            }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Modern thin scrollbar - appears on hover */
        .modern-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: transparent transparent;
            transition: scrollbar-color 0.3s;
        }

        .modern-scrollbar:hover {
            scrollbar-color: rgba(156, 163, 175, 0.5) transparent;
        }

        .modern-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .modern-scrollbar::-webkit-scrollbar-track {
            background: transparent;
            background-clip: padding-box;
        }

        .modern-scrollbar::-webkit-scrollbar-thumb {
            background: transparent;
            border-radius: 3px;
            transition: background 0.3s;
        }

        .modern-scrollbar:hover::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.5);
        }

        .modern-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.7);
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5643020932469823"
        crossorigin="anonymous"></script>

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "NASPICK - AI Stock Ratings",
        "url": "https://naspick.com/en/",
        "description": "AI-powered stock analysis platform. Real-time S&P 500 rankings, quantitative ratings, and investment insights.",
        "inLanguage": "en",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://naspick.com/en/stock/{search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>

    <!-- Organization Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "NASPICK",
        "url": "https://naspick.com/en/",
        "logo": "https://naspick.com/images/og-image.png",
        "description": "AI-powered stock analysis platform. Real-time S&P 500 tier-based analysis and investment insights."
    }
    </script>
</head>

<body class="bg-[#1c1c1f] text-white min-h-screen flex flex-col">
    <h1 class="sr-only">NASPICK - Real-time AI Stock Ratings & Analysis Platform</h1>

    <header class="bg-[#5383e8] py-3 md:py-5 border-b border-[#3e63b0] shadow-lg z-20">
        <div
            class="container mx-auto px-4 flex flex-row items-center justify-between md:grid md:grid-cols-3 gap-3 md:gap-4">
            <div class="flex items-center gap-2 shrink-0">
                <a href="/en/"
                    class="text-xl md:text-3xl font-black italic tracking-tighter text-white drop-shadow-[0_4px_3px_rgba(0,0,0,0.5)] cursor-pointer hover:opacity-90 transition block">
                    NASPICK
                </a>

            </div>

            <div class="relative flex-1 max-w-[200px] md:max-w-sm flex justify-end md:justify-center md:ml-32">
                <input type="text" id="searchInput" placeholder="Ticker or name..."
                    class="w-full bg-[#3e63b0] text-white placeholder-blue-200/50 px-3 py-2 md:px-5 md:py-3 text-sm md:text-base rounded-full border border-blue-400 focus:outline-none focus:ring-2 focus:ring-white transition shadow-inner font-bold">
                <div id="searchResults"
                    class="absolute top-full left-0 right-0 mt-2 bg-[#282830] rounded-lg shadow-xl border border-gray-700 hidden z-50 max-h-64 overflow-y-auto">
                </div>
            </div>

            <!-- Language Switcher -->
            <div class="flex items-center justify-end">
                <a href="/"
                    class="flex items-center gap-1.5 text-blue-200 hover:text-white transition px-3 py-1.5 rounded-full hover:bg-[#3e63b0] group"
                    title="한국어">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9">
                        </path>
                    </svg>
                    <span class="text-xs font-bold tracking-wide">KO</span>
                </a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6 flex gap-6 items-stretch flex-1">

        <aside
            class="w-[360px] shrink-0 bg-[#282830] rounded-lg p-4 shadow-lg hidden lg:flex flex-col border border-gray-800">
            <h2 class="text-gray-400 text-xs font-bold mb-4">WATCHLIST</h2>
            <div id="watchlistGrid" class="grid grid-cols-3 gap-2 overflow-y-auto pr-1">
            </div>
        </aside>

        <section class="flex-1 w-full min-w-0 h-auto md:h-full flex flex-col">

            <div class="bg-[#282830] rounded-xl border border-gray-800 p-4 md:p-6 mb-4 shadow-2xl relative overflow-hidden group transition-all duration-300"
                id="chartCard">
                <div
                    class="absolute top-0 left-1/2 transform -translate-x-1/2 w-full h-[300px] bg-gradient-to-b from-[#38bdf8]/10 to-transparent pointer-events-none rounded-full blur-3xl opacity-50 transition duration-1000 group-hover:opacity-80">
                </div>

                <div class="relative z-10">
                    <div class="mb-4">
                        <div class="flex justify-between items-start mb-3">
                            <h2
                                class="text-gray-400 text-[10px] md:text-xs font-bold uppercase tracking-widest opacity-70 flex items-center">
                                Market Outperformance
                                <span id="periodText"
                                    class="text-[9px] text-gray-500 font-normal ml-2 tracking-normal normal-case opacity-0 transition-opacity duration-500"></span>
                            </h2>
                            <button onclick="toggleChart()"
                                class="text-gray-500 hover:text-white transition p-1 -mr-2 -mt-2">
                                <svg id="chartToggleIcon" class="w-5 h-5 transform transition-transform duration-300"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>

                        <div class="flex justify-between items-end cursor-pointer" onclick="toggleChart()">
                            <div>
                                <div class="flex items-center gap-2 mb-0.5">
                                    <span class="w-2 h-2 rounded-full bg-[#38bdf8] shadow-[0_0_8px_#38bdf8]"></span>
                                    <span class="text-xs font-bold text-[#38bdf8] tracking-wider">NASPICK
                                        PORTFOLIO</span>
                                </div>
                                <div class="text-4xl md:text-5xl font-black text-[#38bdf8] tracking-tighter drop-shadow-[0_0_15px_rgba(56,189,248,0.4)]"
                                    id="sb1Return">Loading...</div>
                            </div>

                            <div class="text-right pb-1">
                                <div class="flex items-center justify-end gap-2 mb-1">
                                    <span class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">S&P
                                        500
                                        (Market)</span>
                                    <span class="w-3 h-0.5 bg-gray-500/50"></span>
                                </div>
                                <div class="text-xl md:text-2xl font-bold text-gray-400 font-mono tracking-tight"
                                    id="spyReturn">...</div>
                            </div>
                        </div>
                    </div>

                    <div id="chartBody"
                        class="w-full overflow-hidden transition-[max-height,opacity] duration-500 ease-in-out max-h-0 opacity-0">
                        <div class="h-[160px] md:h-[280px] w-full">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="relative mb-4 group">
                <div
                    class="absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l from-[#1c1c1f] to-transparent z-10 pointer-events-none">
                </div>
                <nav id="categoryNav"
                    class="flex gap-2 overflow-x-auto mobile-no-scrollbar pc-scrollbar pb-2 items-center pr-4">
                    <!-- Favorites Button Added Dynamically -->
                    <button data-cat="all"
                        class="px-4 py-2 bg-[#5383e8] text-white font-bold text-xs rounded-full border border-[#5383e8] whitespace-nowrap shadow-lg shadow-blue-500/20 hover:bg-[#426dc6] transition flex-shrink-0 active-cat">
                        All Stocks
                    </button>
                </nav>
            </div>

            <div class="flex justify-between items-center mb-3 px-2">
                <span class="text-xs text-gray-500">※ Data updated every 15 mins</span>
            </div>

            <div
                class="bg-[#282830] rounded-lg shadow-xl overflow-hidden h-[calc(100vh-280px)] min-h-[600px] flex flex-col border border-gray-800 border-b-[12px] border-b-[#23232a]">
                <div
                    class="grid grid-cols-12 gap-2 p-2 md:p-3 md:pr-[18px] text-xs text-gray-400 border-b border-gray-700 font-bold bg-[#23232a]">
                    <div
                        class="col-span-3 md:col-span-2 flex items-center justify-start pl-2 gap-1 md:gap-2 relative text-[10px] md:text-xs">
                        <div class="w-5 h-5 md:w-6 md:h-6"></div> <!-- Ghost Star Spacer -->
                        <span class="md:relative md:right-px">Rank</span>
                    </div>
                    <div
                        class="col-span-3 md:col-span-3 flex items-center justify-start pl-2 text-[10px] md:text-xs md:relative md:right-px">
                        Stock</div>
                    <div
                        class="col-span-2 md:col-span-1 flex items-center justify-start pl-2 text-[10px] md:text-xs md:relative md:right-px">
                        Rating</div>
                    <div
                        class="hidden md:flex md:col-span-1 items-center justify-start pl-2 text-[10px] md:text-xs md:relative md:right-px">
                        Score</div>
                    <div
                        class="col-span-2 md:col-span-1 flex items-center justify-start pl-2 text-[10px] md:text-xs md:relative md:right-px">
                        Price</div>
                    <div
                        class="col-span-2 md:col-span-1 flex items-center justify-start pl-2 text-[10px] md:text-xs md:relative md:right-px">
                        Sector</div>
                    <div
                        class="hidden md:flex md:col-span-3 items-center justify-start pl-2 text-left md:relative md:right-px">
                        Related (Top Picks)</div>
                </div>
                <div id="rankingList" class="overflow-y-scroll flex-1 modern-scrollbar relative"
                    style="overflow-y: overlay;">
                    <div id="rankingRows">
                        <div class="p-10 text-center text-gray-500 text-sm">Loading data...</div>
                    </div>
                </div>
            </div>
            </div>
        </section>
    </main>

    <script>
        let favorites = new Set(JSON.parse(localStorage.getItem('naspick_favorites') || '[]'));

        function toggleFavorite(ticker, event) {
            if (event) event.stopPropagation();

            if (favorites.has(ticker)) {
                favorites.delete(ticker);
            } else {
                favorites.add(ticker);
            }
            localStorage.setItem('naspick_favorites', JSON.stringify([...favorites]));

            // Re-render components
            renderWatchlist();

            // If current view is favorites, re-render list
            const activeBtn = document.querySelector('nav button.active-cat');
            if (activeBtn && activeBtn.dataset.cat === 'favorites') {
                const favData = allData.filter(d => favorites.has(d.ticker));
                renderList(favData, 'favorites');
            } else {
                // Just update star icons without full re-render for better performance
                updateStarIcons();
            }
        }

        function updateStarIcons() {
            document.querySelectorAll('.star-btn').forEach(btn => {
                const ticker = btn.dataset.ticker;
                const svgs = btn.getElementsByTagName('svg');
                if (svgs.length > 0) {
                    const svg = svgs[0];
                    if (favorites.has(ticker)) {
                        svg.classList.remove('text-gray-600', 'fill-transparent', 'group-hover:text-yellow-400');
                        svg.classList.add('text-yellow-400', 'fill-current');
                    } else {
                        svg.classList.remove('text-yellow-400', 'fill-current');
                        svg.classList.add('text-gray-600', 'fill-transparent', 'group-hover:text-yellow-400');
                    }
                }
            });
        }

        // English sector names
        const SECTORS = [
            "Technology", "Communication", "Consumer Discretionary", "Consumer Staples", "Energy",
            "Financials", "Healthcare", "Industrials", "Materials", "Real Estate", "Utilities"
        ];

        // Korean to English sector mapping (for data compatibility)
        const SECTOR_KR_TO_EN = {
            "기술": "Technology",
            "커뮤니케이션": "Communication",
            "임의소비재": "Consumer Discretionary",
            "필수소비재": "Consumer Staples",
            "에너지": "Energy",
            "금융": "Financials",
            "헬스케어": "Healthcare",
            "산업재": "Industrials",
            "소재": "Materials",
            "부동산": "Real Estate",
            "유틸리티": "Utilities"
        };

        // SEO: Sector URL slug mapping
        const SECTOR_SLUGS = {
            "Technology": "technology",
            "Communication": "communication",
            "Consumer Discretionary": "consumer-discretionary",
            "Consumer Staples": "consumer-staples",
            "Energy": "energy",
            "Financials": "financials",
            "Healthcare": "healthcare",
            "Industrials": "industrials",
            "Materials": "materials",
            "Real Estate": "real-estate",
            "Utilities": "utilities"
        };

        // Reverse mapping: slug -> english name
        const SLUG_TO_SECTOR = Object.fromEntries(
            Object.entries(SECTOR_SLUGS).map(([k, v]) => [v, k])
        );

        // English to Korean reverse mapping for data filtering
        const SECTOR_EN_TO_KR = Object.fromEntries(
            Object.entries(SECTOR_KR_TO_EN).map(([k, v]) => [v, k])
        );

        async function loadData() {
            try {
                const resData = await fetch('/data/data.json?t=' + new Date().getTime());
                allData = await resData.json();

                // Render UI immediately
                renderWatchlist();
                renderFilters();

                // SEO Check logic...
                const pathParts = window.location.pathname.split('/');
                // Check for /en/sector/slug pattern
                if (pathParts[2] === 'sector' && pathParts[3]) {
                    const slug = pathParts[3];
                    const sectorEn = SLUG_TO_SECTOR[slug];
                    if (sectorEn) selectSector(sectorEn);
                    else renderList(allData);
                } else {
                    renderList(allData);
                }

                initSearch();

                // Fetch Chart Data in background
                fetch('/data/chart_data.json?t=' + new Date().getTime())
                    .then(res => res.json())
                    .then(chartData => {
                        if (chartData) renderChart(chartData);
                    })
                    .catch(e => console.log('Chart data load skipped or failed'));


            } catch (err) {
                console.error(err);
                document.getElementById('rankingRows').innerHTML = '<div class="p-10 text-center text-red-500">Failed to load data.</div>';
            }
        }

        // SEO: Select sector and update URL
        function selectSector(sectorEn) {
            const slug = SECTOR_SLUGS[sectorEn];
            const sectorKr = SECTOR_EN_TO_KR[sectorEn];

            // Update URL without page reload
            if (slug) {
                history.pushState({ sector: sectorEn }, '', `/en/sector/${slug}`);

                // Update page title and meta for SEO
                document.title = `Best ${sectorEn} Stocks to Buy | NASPICK`;
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc) {
                    metaDesc.setAttribute('content', `Top-rated ${sectorEn} stocks with AI analysis. Discover the best ${sectorEn} picks today.`);
                }
            }

            // Update button styles
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('bg-[#5383e8]', 'text-white', 'border-[#5383e8]', 'shadow-lg');
                b.classList.add('bg-[#282830]', 'text-gray-400', 'border-gray-700');
                if (b.textContent === sectorEn) {
                    b.classList.remove('bg-[#282830]', 'text-gray-400', 'border-gray-700');
                    b.classList.add('bg-[#5383e8]', 'text-white', 'border-[#5383e8]', 'shadow-lg');
                }
            });

            // Filter by Korean sector name (data uses Korean)
            const filtered = allData.filter(d => d.sector === sectorKr);
            renderList(filtered, sectorEn);
        }

        // SEO: Reset to all stocks
        function selectAll() {
            history.pushState({ sector: 'all' }, '', '/en/');
            document.title = 'Best Stocks to Buy Today | AI Stock Ratings - NASPICK';
            const metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) {
                metaDesc.setAttribute('content', 'Discover top-rated S&P 500 stocks with AI-powered analysis. Real-time stock rankings, price targets, and quantitative ratings.');
            }

            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('bg-[#5383e8]', 'text-white', 'border-[#5383e8]', 'shadow-lg');
                b.classList.add('bg-[#282830]', 'text-gray-400', 'border-gray-700');
            });
            const allBtn = document.querySelector('nav button[data-cat="all"]');
            if (allBtn) {
                allBtn.classList.remove('bg-[#282830]', 'text-gray-400', 'border-gray-700');
                allBtn.classList.add('bg-[#5383e8]', 'text-white', 'border-[#5383e8]', 'shadow-lg');
            }

            renderList(allData, 'all');
        }

        // Handle browser back/forward
        window.addEventListener('popstate', (e) => {
            if (e.state && e.state.sector) {
                if (e.state.sector === 'all') {
                    selectAll();
                } else {
                    selectSector(e.state.sector);
                }
            }
        });

        function renderChart(data) {
            if (!data || data.length === 0) return;

            // Format Data & Convert to % Return
            const dates = data.map(d => d.date);
            const sb1_start = data[0].sb1;
            const spy_start = data[0].spy;

            const sb1 = data.map(d => ((d.sb1 - sb1_start) / sb1_start * 100));
            const spy = data.map(d => ((d.spy - spy_start) / spy_start * 100));

            // Returns calculation
            const sb1_ret = sb1[sb1.length - 1].toFixed(1);
            const spy_ret = spy[spy.length - 1].toFixed(1);

            document.getElementById('sb1Return').innerText = `+${sb1_ret}%`;
            document.getElementById('spyReturn').innerText = `+${spy_ret}%`;

            // Set Period Text
            const startD = dates[0].replace(/-/g, '/');
            document.getElementById('periodText').innerText = `(Since ${startD})`;
            document.getElementById('periodText').classList.remove('opacity-0');

            const ctx = document.getElementById('performanceChart').getContext('2d');

            // Gradient fill (Sky Blue)
            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(56, 189, 248, 0.2)');
            gradient.addColorStop(1, 'rgba(56, 189, 248, 0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Naspick Portfolio',
                            data: sb1,
                            borderColor: '#38bdf8',
                            backgroundColor: gradient,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            pointBackgroundColor: '#38bdf8'
                        },
                        {
                            label: 'S&P 500',
                            data: spy,
                            borderColor: '#6b7280',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1c1c1f',
                            titleColor: '#9ca3af',
                            bodyColor: '#fff',
                            borderColor: '#374151',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: true,
                            callbacks: {
                                label: function (context) {
                                    let val = context.parsed.y;
                                    let sign = val >= 0 ? '+' : '';
                                    return ' ' + context.dataset.label + ': ' + sign + val.toFixed(2) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false, drawBorder: false },
                            ticks: {
                                maxTicksLimit: 5,
                                color: '#6b7280',
                                font: { size: 10 }
                            },
                            border: { display: false }
                        },
                        y: {
                            grid: {
                                color: '#2d2d35',
                                borderDash: [5, 5],
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { size: 10 },
                                callback: function (value) { return value + '%'; }
                            },
                            border: { display: false }
                        }
                    }
                }
            });
        }

        let isChartExpanded = false;
        function toggleChart() {
            const body = document.getElementById('chartBody');
            const icon = document.getElementById('chartToggleIcon');

            isChartExpanded = !isChartExpanded;

            if (isChartExpanded) {
                body.style.maxHeight = '500px';
                body.style.opacity = '1';
                icon.style.transform = 'rotate(0deg)';
            } else {
                body.style.maxHeight = '0px';
                body.style.opacity = '0';
                icon.style.transform = 'rotate(180deg)';
            }
        }

        function renderWatchlist() {
            const container = document.getElementById('watchlistGrid');
            const favList = [...favorites];

            if (favList.length === 0) {
                container.innerHTML = `<div class="col-span-3 text-center text-gray-500 text-xs py-10">Click the star icon<br>to add stocks to watchlist.</div>`;
                return;
            }

            const favData = allData.filter(d => favorites.has(d.ticker));

            // Sort by Rank if available, or name
            favData.sort((a, b) => (a.rank || 999) - (b.rank || 999));

            container.innerHTML = favData.map((item) => `
                <div class="relative group aspect-square">
                    <button onclick="toggleFavorite('${item.ticker}', event)" class="absolute top-1 right-1 hover:scale-110 transition z-20 cursor-pointer">
                        <svg class="w-3.5 h-3.5 text-yellow-400 fill-current drop-shadow-md" 
                             xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                        </svg>
                    </button>
                    <a href="/en/stock/${item.ticker}" 
                       class="w-full h-full bg-[#31313c] rounded-lg border border-gray-700 flex flex-col items-center justify-center cursor-pointer hover:border-gray-500 transition hover:bg-[#3a3a45] p-2 block text-inherit hover:no-underline">
                        <img src="https://financialmodelingprep.com/image-stock/${item.ticker.replace('.', '-')}.png"  
                             alt="${item.ticker} logo"
                             onerror="this.src='https://ui-avatars.com/api/?name=${item.ticker}&background=5383e8&color=fff&size=200'" 
                             style="filter: invert(1) hue-rotate(180deg);" class="w-7 h-7 rounded mb-2 object-contain shadow-md">
                        <div class="text-xs font-bold text-gray-200 tracking-tight text-center leading-tight mb-0.5">${item.name_en || item.name}</div>
                        <div class="text-[9px] font-medium text-gray-500 tracking-wider mb-0.5 leading-none">${item.ticker}</div>
                        <div class="text-xs font-bold ${item.change_pct >= 0 ? 'text-green-400' : 'text-red-400'}">
                            ${item.change_pct > 0 ? '+' : ''}${item.change_pct}%
                        </div>
                    </a>
                </div>
            `).join('');
        }

        function renderFilters() {
            const nav = document.getElementById('categoryNav');
            nav.innerHTML = '';

            // 1. Favorites Button (First)
            const favBtn = document.createElement('button');
            favBtn.className = "px-3 py-2 bg-[#282830] text-gray-400 font-medium text-xs rounded-full border border-gray-700 whitespace-nowrap hover:bg-gray-700 hover:text-white hover:border-gray-500 transition flex-shrink-0 flex items-center gap-1 group";
            favBtn.innerHTML = `
                <svg class="w-3.5 h-3.5 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                </svg>
            `;
            favBtn.dataset.cat = 'favorites';
            favBtn.onclick = () => {
                document.querySelectorAll('nav button').forEach(b => {
                    b.classList.remove('bg-[#5383e8]', 'text-white', 'border-[#5383e8]', 'shadow-lg', 'active-cat');
                    b.classList.add('bg-[#282830]', 'text-gray-400', 'border-gray-700');
                });
                favBtn.classList.remove('bg-[#282830]', 'text-gray-400', 'border-gray-700');
                favBtn.classList.add('bg-[#5383e8]', 'text-white', 'border-[#5383e8]', 'shadow-lg', 'active-cat');

                const favData = allData.filter(d => favorites.has(d.ticker));
                renderList(favData, 'favorites');

                // Update URL for favorites? Maybe just keep as is or clean URL
                history.pushState({ sector: 'favorites' }, '', '#favorites');
            };
            nav.appendChild(favBtn);

            // 2. All Button
            const allBtn = document.createElement('button');
            allBtn.className = "px-4 py-2 bg-[#5383e8] text-white font-bold text-xs rounded-full border border-[#5383e8] whitespace-nowrap shadow-lg shadow-blue-500/20 hover:bg-[#426dc6] transition flex-shrink-0 active-cat";
            allBtn.textContent = "All Stocks";
            allBtn.dataset.cat = 'all';
            allBtn.onclick = () => selectAll();
            nav.appendChild(allBtn);

            // 3. Sector Buttons (English)
            SECTORS.forEach(sec => {
                const btn = document.createElement('button');
                btn.className = "px-3 py-2 bg-[#282830] text-gray-400 font-medium text-xs rounded-full border border-gray-700 whitespace-nowrap hover:bg-gray-700 hover:text-white hover:border-gray-500 transition flex-shrink-0";
                btn.textContent = sec;
                btn.onclick = () => selectSector(sec);
                nav.appendChild(btn);
            });
        }

        function renderList(data, category = 'all') {
            const list = document.getElementById('rankingRows');

            // Handle empty case
            if (data.length === 0) {
                list.innerHTML = '<div class="p-10 text-center text-gray-500 text-sm">Click the star icon to add stocks to your watchlist.</div>';
                return;
            }

            // [Performance] Progressive Rendering
            // Render first 50 items immediately
            const CHUNK_SIZE = 50;
            const initialData = data.slice(0, CHUNK_SIZE);

            list.innerHTML = initialData.map((item, idx) => createRowHtml(item, idx, category)).join('');

            // Render remaining items in next frame
            if (data.length > CHUNK_SIZE) {
                setTimeout(() => {
                    const remainingData = data.slice(CHUNK_SIZE);
                    const remainingHtml = remainingData.map((item, idx) => createRowHtml(item, idx + CHUNK_SIZE, category)).join('');
                    list.insertAdjacentHTML('beforeend', remainingHtml);
                }, 0);
            }
        }

        // Helper function for row HTML to clean up code
        function createRowHtml(item, idx, category) {
            // Use green for up, red for down (US convention)
            const changeColor = item.change_pct >= 0 ? 'text-green-400' : 'text-red-400';

            // Rating labels instead of "Tier"
            let tierClass = 'text-gray-400 border-gray-600 bg-gray-700/20';
            let tierLabel = 'C';
            if (item.tier === 1) { tierClass = 'text-[#0093ff] border-[#0093ff] bg-[#0093ff]/10'; tierLabel = 'A+'; }
            else if (item.tier === 2) { tierClass = 'text-[#00bba3] border-[#00bba3] bg-[#00bba3]/10'; tierLabel = 'A'; }
            else if (item.tier === 3) { tierClass = 'text-[#ffb900] border-[#ffb900] bg-[#ffb900]/10'; tierLabel = 'B'; }
            else if (item.tier === 4) { tierClass = 'text-[#9aa4af] border-[#9aa4af] bg-[#9aa4af]/10'; tierLabel = 'C'; }
            else if (item.tier === 5) { tierClass = 'text-[#a07557] border-[#a07557] bg-[#a07557]/10'; tierLabel = 'D'; }

            const tierBadge = `<span class="px-1.5 py-0.5 text-[9px] md:text-[10px] font-bold rounded border ${tierClass}">${tierLabel}</span>`;

            // Get English sector name
            const sectorEn = SECTOR_KR_TO_EN[item.sector] || item.sector;

            // Determine which rank to show: Overall or Sector
            let displayRank, displayChange;
            if (category === 'all' || category === 'favorites') {
                displayRank = item.rank;
                displayChange = item.rank_change;
            } else {
                displayRank = item.sector_rank;
                displayChange = item.sector_rank_change;
            }

            // If rank is missing (new stock), handle safely
            if (!displayRank) displayRank = idx + 1;

            return `
                <div onclick="location.href='/en/stock/${item.ticker}'" 
                    class="grid grid-cols-12 gap-2 p-2 md:p-3 items-center border-b border-gray-700 hover:bg-[#31313c] transition cursor-pointer group h-14 md:h-16">
                    
                    <div class="col-span-3 md:col-span-2 flex items-center justify-start pl-2 gap-1 md:gap-2 relative">
                        <button onclick="toggleFavorite('${item.ticker}', event)" 
                                data-ticker="${item.ticker}"
                                class="star-btn transition hover:scale-110 p-1 group">
                            <svg class="w-5 h-5 md:w-6 md:h-6 ${favorites.has(item.ticker) ? 'text-yellow-400 fill-current' : 'text-gray-600 fill-transparent group-hover:text-yellow-400'}" 
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                            </svg>
                        </button>
                        
                        <div class="font-bold text-sm md:text-lg italic text-[#5383e8] w-9 md:w-8 text-left tracking-tighter">${displayRank}</div>
                        <div class="text-[9px] md:text-[10px] font-bold flex items-center justify-start w-6 md:w-8">
                            ${(() => {
                    const change = displayChange || 0;
                    if (change > 0) {
                        return `<span class="text-green-500 flex items-center">▲ ${change}</span>`;
                    } else if (change < 0) {
                        return `<span class="text-red-500 flex items-center">▼ ${Math.abs(change)}</span>`;
                    } else {
                        return `<span class="text-gray-600">=</span>`;
                    }
                })()}
                        </div>
                    </div>
                    
                    <a href="/en/stock/${item.ticker}" onclick="event.stopPropagation()" class="col-span-3 md:col-span-3 flex items-center justify-start pl-2 gap-2 overflow-hidden block text-inherit hover:no-underline">
                        <div class="w-6 h-6 md:w-9 md:h-9 rounded flex items-center justify-center p-0.5 shrink-0 overflow-hidden bg-[#31313c]">
                            <img src="https://financialmodelingprep.com/image-stock/${item.ticker.replace('.', '-')}.png" 
                                alt="${item.name_en || item.name} logo"
                                loading="lazy"
                                onerror="this.src='https://ui-avatars.com/api/?name=${item.ticker}&background=5383e8&color=fff&size=128'" 
                                style="filter: invert(1) hue-rotate(180deg);" class="w-full h-full object-contain">
                        </div>
                        <div class="min-w-0 text-left">
                            <div class="font-bold text-gray-100 text-xs md:text-sm truncate">${item.name_en || item.name}</div>
                            <div class="text-[9px] md:text-[10px] text-gray-500">${item.ticker}</div>
                        </div>
                    </a>

                    <div class="col-span-2 md:col-span-1 flex items-center justify-start pl-2">
                        ${tierBadge}
                    </div>

                    <div class="hidden md:flex md:col-span-1 items-center justify-start pl-2 font-bold text-gray-300 text-xs md:text-sm">
                        ${item.final_score}
                    </div>

                    <div class="col-span-2 md:col-span-1 text-left pl-2">
                        <div class="font-bold text-gray-200 text-xs md:text-sm">$${(item.current_price || 0).toFixed(2)}</div>
                        <div class="text-[9px] md:text-[10px] font-bold ${changeColor}">
                            ${item.change_pct > 0 ? '+' : ''}${item.change_pct}%
                        </div>
                    </div>

                    <div class="col-span-2 md:col-span-1 text-left pl-2">
                        <span class="text-[9px] md:text-[10px] text-gray-200 bg-gray-600 px-1.5 py-0.5 rounded whitespace-nowrap tracking-tighter inline-block overflow-hidden text-ellipsis max-w-full">${sectorEn}</span>
                    </div>

                        <div class="hidden md:flex md:col-span-3 text-left pl-2 gap-1 items-center h-full">
                            ${(item.related_peers || []).slice(0, 3).map(rel => `
                                <a href="/en/stock/${rel.ticker}" onclick="event.stopPropagation()"
                                class="w-6 h-6 md:w-7 md:h-7 rounded-full bg-[#3a3a45] flex items-center justify-center border border-gray-600 hover:border-gray-400 transition" 
                                title="${rel.name}">
                                    <img src="https://financialmodelingprep.com/image-stock/${rel.ticker.replace('.', '-')}.png" 
                                        alt="${rel.ticker}"
                                        loading="lazy"
                                        onerror="this.style.display='none'"
                                        class="w-full h-full rounded-full object-contain p-0.5">
                                </a>
                            `).join('')}
                        </div>
                </div>
            `;
        }

        function initSearch() {
            const input = document.getElementById('searchInput');
            const resultsDiv = document.getElementById('searchResults');

            input.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                if (!term) {
                    resultsDiv.classList.add('hidden');
                    return;
                }

                // Search aliases for common brand names
                const SEARCH_ALIASES = {
                    'google': ['GOOGL', 'GOOG'],
                    'facebook': ['META'],
                    'berkshire': ['BRK.B']
                };

                // Check if search term matches any alias
                let aliasMatches = [];
                for (const [alias, tickers] of Object.entries(SEARCH_ALIASES)) {
                    if (alias.includes(term) || term.includes(alias)) {
                        aliasMatches = aliasMatches.concat(tickers);
                    }
                }

                const matches = allData.filter(d =>
                    d.ticker.toLowerCase().includes(term) ||
                    (d.name && d.name.toLowerCase().includes(term)) ||
                    (d.name_en && d.name_en.toLowerCase().includes(term)) ||
                    aliasMatches.includes(d.ticker)
                ).slice(0, 10);

                if (matches.length > 0) {
                    resultsDiv.innerHTML = matches.map(d => `
                        <a href="/en/stock/${d.ticker}" class="p-3 hover:bg-[#3e63b0] cursor-pointer border-b border-gray-700 last:border-0 flex justify-between items-center block text-inherit hover:no-underline">
                            <div>
                                <div class="flex items-center gap-2">
                                     <span class="font-bold text-sm text-white">${d.ticker}</span>
                                     <span class="text-xs text-gray-300">${d.name_en || d.name}</span>
                                </div>
                            </div>
                            <span class="text-[#5383e8] text-xs font-bold">${d.final_score} pts</span>
                        </a>
                    `).join('');
                    resultsDiv.classList.remove('hidden');
                } else {
                    resultsDiv.innerHTML = '<div class="p-3 text-gray-500 text-xs">No results found.</div>';
                    resultsDiv.classList.remove('hidden');
                }
            });

            // Close search when clicking outside
            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !resultsDiv.contains(e.target)) {
                    resultsDiv.classList.add('hidden');
                }
            });
        }

        loadData();
    </script>

    <footer class="text-center text-[10px] md:text-xs text-gray-500 py-3 md:py-4 px-4 border-t border-gray-800 mt-4">
        <p>Information on this site is for reference only. Investment decisions and profits/losses are the investor's
            responsibility.</p>
        <p class="mt-1">© 2026 NASPICK</p>
    </footer>
</body>

</html>