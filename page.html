<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï¢ÖÎ™© ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ:ÎÇòÏä§ÌîΩ</title>
    <meta name="description" content="ÎØ∏Íµ≠ Ï£ºÏãù Ïã§ÏãúÍ∞Ñ Ìã∞Ïñ¥ Î∂ÑÏÑù Ï†ïÎ≥¥">
    <!-- Brand Assets -->
    <link rel="icon" type="image/png" href="/favicon.png">

    <!-- Open Graph (Í∏∞Î≥∏Í∞í, JSÏóêÏÑú ÎèôÏ†Å ÏóÖÎç∞Ïù¥Ìä∏) -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="ÎÇòÏä§ÌîΩ">
    <meta property="og:title" content="Ï¢ÖÎ™© ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ | ÎÇòÏä§ÌîΩ">
    <meta property="og:description" content="ÎØ∏Íµ≠ Ï£ºÏãù Ïã§ÏãúÍ∞Ñ Ìã∞Ïñ¥ Î∂ÑÏÑù Ï†ïÎ≥¥">
    <meta property="og:url" content="https://naspick.com/">
    <meta property="og:image" content="https://naspick.com/og-image.png">

    <!-- Twitter Card (Í∏∞Î≥∏Í∞í, JSÏóêÏÑú ÎèôÏ†Å ÏóÖÎç∞Ïù¥Ìä∏) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ï¢ÖÎ™© ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ | ÎÇòÏä§ÌîΩ">
    <meta name="twitter:description" content="ÎØ∏Íµ≠ Ï£ºÏãù Ïã§ÏãúÍ∞Ñ Ìã∞Ïñ¥ Î∂ÑÏÑù Ï†ïÎ≥¥">
    <meta name="twitter:image" content="https://naspick.com/og-image.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
        }

        @keyframes loadBar {
            from {
                width: 0;
            }

            to {
                width: var(--width);
            }
        }

        .stat-bar {
            animation: loadBar 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }
    </style>
</head>

<body class="bg-[#1c1c1f] text-white min-h-screen flex flex-col">

    <header class="bg-[#5383e8] py-3 md:py-5 border-b border-[#3e63b0] shadow-lg z-20">
        <div
            class="container mx-auto px-4 flex flex-row items-center justify-between md:grid md:grid-cols-3 gap-3 md:gap-4">

            <div class="flex items-center gap-3 shrink-0">
                <button onclick="location.href='/'" class="text-blue-200 hover:text-white transition">
                    <svg class="w-6 h-6 md:w-7 md:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                        </path>
                    </svg>
                </button>
                <a href="/"
                    class="text-xl md:text-3xl font-black italic tracking-tighter text-white drop-shadow-[0_4px_3px_rgba(0,0,0,0.5)] cursor-pointer hover:opacity-90 transition block">
                    NASPICK
                </a>
            </div>

            <div class="relative flex-1 max-w-[200px] md:max-w-sm flex justify-end md:justify-center md:ml-32">
                <input type="text" id="headerSearch" placeholder="Ìã∞Ïª§/Ï¢ÖÎ™©Î™Ö..."
                    class="w-full bg-[#3e63b0] text-white placeholder-blue-200/50 px-3 py-2 md:px-5 md:py-3 text-sm md:text-base rounded-full border border-blue-400 focus:outline-none focus:ring-2 focus:ring-white transition shadow-inner font-bold">
                <div id="headerSearchResults"
                    class="absolute top-full right-0 md:right-auto md:left-0 mt-2 w-64 bg-[#282830] rounded-lg shadow-xl border border-gray-700 hidden z-50 max-h-64 overflow-y-auto">
                </div>
            </div>

            <div class="hidden md:block"></div>
        </div>
    </header>

    <main id="mainContent" class="container mx-auto px-4 py-6 max-w-7xl">
        <div class="p-20 text-center text-gray-500">Loading stock data...</div>
    </main>

    <script>
        let allData = [];

        async function init() {
            try {
                // [Î≥ÄÍ≤Ω] Í≤ΩÎ°ú(Path) Î∞©Ïãù: "/stock/TSLA" ÏóêÏÑú "TSLA" Ï∂îÏ∂ú
                const pathSegments = window.location.pathname.split('/');
                let ticker = pathSegments[pathSegments.length - 1];

                // ÌòπÏãú Ï£ºÏÜåÍ∞Ä "/stock/TSLA/" Ï≤òÎüº ÎÅùÏóê Ïä¨ÎûòÏãúÍ∞Ä Î∂ôÏùÑ Í≤ΩÏö∞ ÎåÄÎπÑ
                if (!ticker) ticker = pathSegments[pathSegments.length - 2];

                // URL ÌååÎùºÎØ∏ÌÑ∞Í∞Ä ÏûàÎã§Î©¥ (Í∏∞Ï°¥ Î∞©Ïãù ÌïòÏúÑ Ìò∏Ìôò)
                const params = new URLSearchParams(window.location.search);
                if (!ticker || ticker === 'page.html') {
                    ticker = params.get('ticker');
                }

                if (ticker) ticker = ticker.toUpperCase();

                if (!ticker || ticker === 'STOCK' || ticker === 'PAGE.HTML') {
                    // Ìã∞Ïª§Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ ÌôàÏúºÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏ ÌïòÏßÄ ÏïäÍ≥† ÎåÄÍ∏∞ (ÎòêÎäî ÏóêÎü¨ ÌëúÏãú)
                    // alert('ÏûòÎ™ªÎêú Ï†ëÍ∑ºÏûÖÎãàÎã§.');
                    // location.href = 'index.html';
                    // return;
                }

                if (!ticker) {
                    alert('Ï¢ÖÎ™©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    location.href = '/';
                    return;
                }

                // data.json Í≤ΩÎ°ú Ï£ºÏùò (Î£®Ìä∏ Í∏∞Ï§Ä)
                const res = await fetch('/data.json?t=' + new Date().getTime());
                allData = await res.json();

                const stockData = allData.find(d => d.ticker === ticker);

                if (!stockData) {
                    document.getElementById('mainContent').innerHTML = '<div class="p-20 text-center text-red-400">Ìï¥Îãπ Ï¢ÖÎ™© Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
                    return;
                }

                // --- SEO ÌïµÏã¨ Ï∂îÍ∞Ä: ÎèôÏ†Å ÌÉÄÏù¥ÌãÄ, Î©îÌÉÄÏÑ§Î™Ö, Canonical Tag ---
                const today = new Date();
                const month = today.getMonth() + 1;
                const date = today.getDate();
                const dateString = `${month}Ïõî ${date}Ïùº`;

                // 1. Title ÏóÖÎç∞Ïù¥Ìä∏
                document.title = `${dateString} ${stockData.name}(${stockData.ticker}) Ïã§ÏãúÍ∞Ñ Ìã∞Ïñ¥ & Ï£ºÍ∞Ä Î∂ÑÏÑù | ÎÇòÏä§ÌîΩ`;

                // 2. Meta Description ÏóÖÎç∞Ïù¥Ìä∏
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc) {
                    metaDesc.setAttribute('content',
                        `[${dateString} Í∏∞Ï§Ä] ${stockData.name}(${stockData.ticker}) AI Ï†ïÎ∞Ä Î∂ÑÏÑù. ÌòÑÏû¨Í∞Ä $${stockData.current_price}, ÎÇòÏä§ÌîΩ Ï†êÏàò ${stockData.final_score}Ï†ê(${stockData.tier}Ìã∞Ïñ¥). Í∏∞Í¥Ä ÏàòÍ∏â Ìè¨Ï∞© Î∞è ÏÉÅÏäπ Î™®Î©òÌÖÄ Î∞úÏÉù. 1Ï∞® ÏßÄÏßÄ ÎùºÏù∏ ÌôïÏù∏ÌïòÍ∏∞.`
                    );
                }

                // 3. Canonical Tag ÏÑ§Ï†ï
                let canonicalLink = document.querySelector('link[rel="canonical"]');
                if (!canonicalLink) {
                    canonicalLink = document.createElement('link');
                    canonicalLink.rel = 'canonical';
                    document.head.appendChild(canonicalLink);
                }
                canonicalLink.href = `https://naspick.com/stock/${stockData.ticker}`;

                // 4. OG Image ÎèôÏ†Å ÏóÖÎç∞Ïù¥Ìä∏ (Ï¢ÖÎ™© Î°úÍ≥†)
                // FallbackÏù¥ Ïù¥ÎØ∏ Ìó§ÎçîÏóê ÏûàÏßÄÎßå, Ï¢ÖÎ™©Î≥Ñ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÎã§Î©¥ ÍµêÏ≤¥
                const ogImage = document.querySelector('meta[property="og:image"]');
                if (ogImage) {
                    // FMP Î°úÍ≥† ÌôúÏö© (ÎòêÎäî Ï∞®Ìä∏ Ïù¥ÎØ∏ÏßÄ)
                    ogImage.setAttribute('content', `https://financialmodelingprep.com/image-stock/${stockData.ticker.replace('.', '-')}.png`);
                }
                const twitterImage = document.querySelector('meta[name="twitter:image"]');
                if (twitterImage) {
                    twitterImage.setAttribute('content', `https://financialmodelingprep.com/image-stock/${stockData.ticker.replace('.', '-')}.png`);
                }

                // 5. OG/Twitter Title, Description, URL ÎèôÏ†Å ÏóÖÎç∞Ïù¥Ìä∏
                const ogTitle = document.querySelector('meta[property="og:title"]');
                if (ogTitle) ogTitle.setAttribute('content', `${dateString} ${stockData.name}(${stockData.ticker}) Ïã§ÏãúÍ∞Ñ Ìã∞Ïñ¥ & Ï£ºÍ∞Ä Î∂ÑÏÑù | ÎÇòÏä§ÌîΩ`);

                const ogDesc = document.querySelector('meta[property="og:description"]');
                if (ogDesc) ogDesc.setAttribute('content', `[${dateString} Í∏∞Ï§Ä] ${stockData.name}(${stockData.ticker}) AI Ï†ïÎ∞Ä Î∂ÑÏÑù. ÌòÑÏû¨Í∞Ä $${stockData.current_price}, ÎÇòÏä§ÌîΩ Ï†êÏàò ${stockData.final_score}Ï†ê(${stockData.tier}Ìã∞Ïñ¥).`);

                const ogUrl = document.querySelector('meta[property="og:url"]');
                if (ogUrl) ogUrl.setAttribute('content', `https://naspick.com/stock/${stockData.ticker}`);

                const twitterTitle = document.querySelector('meta[name="twitter:title"]');
                if (twitterTitle) twitterTitle.setAttribute('content', `${dateString} ${stockData.name}(${stockData.ticker}) Ïã§ÏãúÍ∞Ñ Ìã∞Ïñ¥ & Ï£ºÍ∞Ä Î∂ÑÏÑù | ÎÇòÏä§ÌîΩ`);

                const twitterDesc = document.querySelector('meta[name="twitter:description"]');
                if (twitterDesc) twitterDesc.setAttribute('content', `[${dateString} Í∏∞Ï§Ä] ${stockData.name}(${stockData.ticker}) AI Ï†ïÎ∞Ä Î∂ÑÏÑù. ÌòÑÏû¨Í∞Ä $${stockData.current_price}, Ï†êÏàò ${stockData.final_score}Ï†ê.`);
                // ----------------------------------------------------

                renderPage(stockData);
                initHeaderSearch();

            } catch (err) {
                console.error(err);
                document.getElementById('mainContent').innerHTML = '<div class="p-20 text-center text-red-400">Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®</div>';
            }
        }

        function renderPage(data) {
            const isPlus = data.change_pct >= 0;
            const changeColor = isPlus ? 'text-red-400' : 'text-blue-400';
            const changeSign = isPlus ? '‚ñ≤' : '‚ñº';

            let tierBadge = '';
            if (data.tier === 1) tierBadge = `<span class="bg-[#0093ff] text-white text-sm font-bold px-3 py-1 rounded transform -skew-x-12 cursor-help" title="Top 5%">1 TIER</span>`;
            else if (data.tier === 2) tierBadge = `<span class="bg-[#00bba3] text-white text-sm font-bold px-3 py-1 rounded transform -skew-x-12">2 TIER</span>`;
            else if (data.tier === 3) tierBadge = `<span class="bg-[#ffb900] text-white text-sm font-bold px-3 py-1 rounded transform -skew-x-12">3 TIER</span>`;
            else if (data.tier === 4) tierBadge = `<span class="bg-[#9aa4af] text-white text-sm font-bold px-3 py-1 rounded transform -skew-x-12">4 TIER</span>`;
            else tierBadge = `<span class="bg-[#a07557] text-white text-sm font-bold px-3 py-1 rounded transform -skew-x-12">5 TIER</span>`;

            const stats = data.stats_bar || { trend: 0, volume: 0, momentum: 0, impact: 0 };
            const signals = (data.signals || []).map(s => {
                if (s === "RSI_Overbought") return `<span class="text-rose-400 font-bold ml-1">RSI Í≥ºÏó¥Í∂å</span>`;
                if (s === "MACD_GoldenCross") return `<span class="text-amber-400 font-bold ml-1">MACD Golden Cross</span>`;
                return s;
            }).join(', ');

            const html = `
                <section class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6 gap-4">
                    <div class="flex items-center gap-4">
                        <img src="https://financialmodelingprep.com/image-stock/${data.ticker.replace('.', '-')}.png" 
                             alt="${data.name} Î°úÍ≥†"
                             onerror="this.src='https://ui-avatars.com/api/?name=${data.ticker}&background=5383e8&color=fff&size=256'" 
                             style="filter: invert(1) hue-rotate(180deg);" class="w-16 h-16 rounded-lg shadow-lg object-contain">
                        <div>
                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-100">${data.name || data.ticker}</h1>
                                <span class="bg-[#5383e8] text-white text-xs font-bold px-2 py-1 rounded hidden md:inline-block">${data.ticker}</span>
                                ${tierBadge}
                            </div>
                            <div class="text-gray-400 text-sm">${data.sector}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-4xl font-bold font-mono">$${data.current_price}</div>
                        <div class="${changeColor} font-bold text-lg flex items-center justify-end gap-1">
                            ${isPlus ? '‚ñ≤' : ''} ${data.change_pct}% <span class="text-xs text-gray-500 font-normal">Today</span>
                        </div>
                    </div>
                </section>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    
                    <div class="lg:col-span-2 flex flex-col gap-6">
                        
                        <div id="tv_chart_container" class="bg-[#282830] rounded-xl border border-gray-800 h-[500px] relative overflow-hidden group"></div>

                        <div class="bg-[#282830] rounded-xl border border-gray-800 p-6">
                            ${(() => {
                    const r2 = data.levels?.r2 || 0;
                    const s2 = data.levels?.s2 || 0;
                    const current = data.current_price || 0;
                    const range = r2 - s2;
                    let pos = 50;
                    if (range > 0) pos = ((current - s2) / range) * 100;
                    pos = Math.max(0, Math.min(100, pos));

                    let p_s1 = ((data.levels?.s1 - s2) / range) * 100;
                    let p_r1 = ((data.levels?.r1 - s2) / range) * 100;
                    p_s1 = Math.max(0, Math.min(100, p_s1));
                    p_r1 = Math.max(0, Math.min(100, p_r1));

                    return `
                                <div class="relative w-full h-4 bg-gray-800 rounded-full mb-10 mt-8 overflow-visible flex items-center">
                                    <div class="absolute left-0 h-full bg-[#00bba3]/30 border-r border-gray-600 box-border rounded-l-full" style="width: ${p_s1}%;"></div>
                                    <div class="absolute text-[9px] text-gray-500 font-bold -bottom-5 transform -translate-x-1/2" style="left: ${p_s1}%">1Ï∞®ÏßÄÏßÄ</div>
                                    
                                    <div class="absolute h-full bg-gray-600/20 box-border" style="left: ${p_s1}%; width: ${p_r1 - p_s1}%;"></div>
                                    
                                    <div class="absolute h-full bg-[#ef4444]/30 border-l border-gray-600 box-border rounded-r-full" style="left: ${p_r1}%; width: ${100 - p_r1}%;"></div>
                                    <div class="absolute text-[9px] text-gray-500 font-bold -bottom-5 transform -translate-x-1/2" style="left: ${p_r1}%">1Ï∞®Ï†ÄÌï≠</div>

                                    <div class="absolute text-[9px] text-gray-500 font-bold -bottom-5 left-0">2Ï∞®ÏßÄÏßÄ</div>
                                    <div class="absolute text-[9px] text-gray-500 font-bold -bottom-5 right-0">2Ï∞®Ï†ÄÌï≠</div>

                                    <div class="absolute -top-7 text-xs font-bold text-white whitespace-nowrap z-30 transition-all duration-500" style="left: ${pos}%; transform: translateX(-50%);">
                                        ÌòÑÏû¨Í∞Ä: $${current.toFixed(2)}
                                    </div>

                                    <div class="absolute h-6 w-1.5 bg-white shadow-[0_0_10px_rgba(255,255,255,1)] z-20 transition-all duration-500" style="left: ${pos}%; transform: translateX(-50%);"></div>
                                </div>

                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                     <div class="order-2 md:order-1 bg-[#1e1e24] rounded-lg p-4 border border-gray-700 text-center flex flex-col justify-center">
                                        <div class="text-[11px] text-gray-500 mb-1 uppercase tracking-wider">2Ï∞® ÏßÄÏßÄ</div>
                                        <div class="text-blue-500 font-bold text-xl">$${s2.toFixed(2)}</div>
                                    </div>
                                    <div class="order-1 md:order-2 bg-[#1a202e] rounded-lg p-4 border border-blue-500/30 text-center flex flex-col justify-center shadow-[0_0_10px_rgba(59,130,246,0.1)]">
                                        <div class="text-[11px] text-blue-400 mb-1 uppercase tracking-wider font-bold">‚óè 1Ï∞® ÏßÄÏßÄ</div>
                                        <div class="text-blue-300 font-bold text-xl">$${(data.levels?.s1 || 0).toFixed(2)}</div>
                                    </div>
                                    <div class="order-3 bg-[#2e1a1a] rounded-lg p-4 border border-red-500/30 text-center flex flex-col justify-center shadow-[0_0_10px_rgba(239,68,68,0.1)]">
                                        <div class="text-[11px] text-red-400 mb-1 uppercase tracking-wider font-bold">‚óè 1Ï∞® Ï†ÄÌï≠</div>
                                        <div class="text-red-300 font-bold text-xl">$${(data.levels?.r1 || 0).toFixed(2)}</div>
                                    </div>
                                    <div class="order-4 bg-[#1e1e24] rounded-lg p-4 border border-gray-700 text-center flex flex-col justify-center">
                                        <div class="text-[11px] text-gray-500 mb-1 uppercase tracking-wider">2Ï∞® Ï†ÄÌï≠</div>
                                        <div class="text-red-500 font-bold text-xl">$${r2.toFixed(2)}</div>
                                    </div>
                                </div>
                                `;
                })()}
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                           </div>
                    </div>

                    <div class="flex flex-col gap-4">
                        
                        <div class="bg-[#282830] rounded-xl border border-gray-700 p-6 relative overflow-hidden shadow-2xl">
                             <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none">
                                <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 20 20"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path></svg>
                            </div>
                            
                            <h2 class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-4 border-b border-gray-700 pb-2 flex justify-between">
                                <span>Naspick Score Breakdown</span>
                                <span class="text-white opacity-50">v1.1</span>
                            </h2>
                            
                            <div class="flex items-end gap-2 mb-6">
                                <span class="text-5xl font-extrabold text-[#5383e8] tracking-tighter">${data.final_score}</span>
                                <span class="text-lg font-bold text-gray-500 mb-2">/ 100</span>
                            </div>

                            <div class="space-y-5">
                                <div>
                                    <div class="flex justify-between text-xs mb-1.5">
                                        <span class="text-gray-300 font-bold">Fundamentals (Ïã§Ï†Å/ÏÑ±Ïû•)</span>
                                        <span class="text-blue-400 font-bold">${stats.trend}%</span>
                                    </div>
                                    <div class="w-full bg-gray-700 h-2.5 rounded-full overflow-hidden">
                                        <div class="stat-bar bg-gradient-to-r from-blue-600 to-blue-400 h-full shadow-[0_0_10px_rgba(59,130,246,0.5)]" style="--width: ${stats.trend}%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between text-xs mb-1.5">
                                        <span class="text-gray-300 font-bold">Value (Í∞ÄÏπòÌèâÍ∞Ä)</span>
                                        <span class="text-amber-400 font-bold">${stats.impact}%</span>
                                    </div>
                                    <div class="w-full bg-gray-700 h-2.5 rounded-full overflow-hidden">
                                        <div class="stat-bar bg-gradient-to-r from-amber-600 to-amber-400 h-full shadow-[0_0_10px_rgba(245,158,11,0.5)]" style="--width: ${stats.impact}%"></div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between text-xs mb-1.5">
                                        <span class="text-gray-300 font-bold">Momentum (ÏÉÅÏäπÌÉÑÎ†•)</span>
                                        <span class="text-rose-400 font-bold">${stats.momentum}%</span>
                                    </div>
                                    <div class="w-full bg-gray-700 h-2.5 rounded-full overflow-hidden">
                                        <div class="stat-bar bg-gradient-to-r from-rose-600 to-rose-400 h-full shadow-[0_0_10px_rgba(244,63,94,0.5)]" style="--width: ${stats.momentum}%"></div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between text-xs mb-1.5">
                                        <span class="text-gray-300 font-bold">Sentiment (ÏàòÍ∏â/Ïã¨Î¶¨)</span>
                                        <span class="text-green-400 font-bold">${stats.volume}%</span>
                                    </div>
                                    <div class="w-full bg-gray-700 h-2.5 rounded-full overflow-hidden">
                                        <div class="stat-bar bg-gradient-to-r from-green-600 to-green-400 h-full shadow-[0_0_10px_rgba(34,197,94,0.5)]" style="--width: ${stats.volume}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-[#282830] rounded-xl border border-gray-800 p-5">
                            <h3 class="flex items-center gap-2 text-sm font-bold text-gray-200 mb-4">
                                <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Í∏∞Ïà†Ï†Å Î∂ÑÏÑù
                            </h3>
                            <div class="space-y-4">
                                ${(() => {
                    const ta = data.technical_analysis || {};
                    let html = '';

                    // 1. Candle Pattern
                    const cp = ta.candle_pattern;
                    if (cp) {
                        const imgPath = '/images/candle_patterns/' + cp.pattern + '.png';
                        html += `
                                            <div class="bg-[#1e1e24] rounded-lg p-3 border border-gray-700">
                                                <div class="text-[10px] text-gray-500 uppercase tracking-wider mb-2">Ï∫îÎì§ Ìå®ÌÑ¥</div>
                                                <div class="flex items-center gap-3">
                                                    <img src="${imgPath}" alt="${cp.name_kr}" class="w-12 h-12 object-contain" onerror="this.style.display='none'">
                                                    <div>
                                                        <div class="text-sm font-bold ${cp.signal === 'bullish' ? 'text-green-400' : 'text-red-400'}">${cp.name_kr}</div>
                                                        <div class="text-[10px] text-gray-500">${cp.desc} (${cp.date})</div>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                    } else {
                        html += `
                                            <div class="bg-[#1e1e24] rounded-lg p-3 border border-gray-700">
                                                <div class="text-[10px] text-gray-500 uppercase tracking-wider mb-1">Ï∫îÎì§ Ìå®ÌÑ¥</div>
                                                <div class="text-xs text-gray-500">ÏµúÍ∑º 5Ïùº ÎÇ¥ ÌäπÏù¥ Ìå®ÌÑ¥ ÏóÜÏùå</div>
                                            </div>
                                        `;
                    }

                    // 2. RSI (Gauge Chart Style)
                    const rsi = ta.rsi || { value: 50, status: 'neutral' };
                    // Color logic: Overbought=Red, Oversold=Blue, Others=Gray
                    const rsiColor = rsi.status === 'overbought' ? 'text-red-400' :
                        rsi.status === 'oversold' ? 'text-blue-400' : 'text-gray-400';
                    const rsiLabel = rsi.status === 'overbought' ? 'Í≥ºÎß§Ïàò' :
                        rsi.status === 'oversold' ? 'Í≥ºÎß§ÎèÑ' :
                            rsi.status === 'bullish' ? 'Í∞ïÏÑ∏' : 'ÏïΩÏÑ∏';

                    html += `
                                        <div class="bg-[#1e1e24] rounded-lg p-3 border border-gray-700">
                                            <div class="flex justify-between items-center mb-3">
                                                <div class="text-[10px] text-gray-500 uppercase tracking-wider">RSI (14)</div>
                                                <div class="${rsiColor} text-xs font-bold">${rsiLabel}</div>
                                            </div>
                                            <div class="relative">
                                                <!-- RSI Gauge Background with zones -->
                                                <div class="h-3 rounded-full overflow-hidden flex">
                                                    <div class="w-[30%] bg-gradient-to-r from-blue-600 to-blue-500"></div>
                                                    <div class="w-[40%] bg-gradient-to-r from-blue-500 via-gray-600 to-red-500"></div>
                                                    <div class="w-[30%] bg-gradient-to-r from-red-500 to-red-600"></div>
                                                </div>
                                                <!-- RSI Marker -->
                                                <div class="absolute top-0 h-3 flex items-center" style="left: ${rsi.value}%; transform: translateX(-50%);">
                                                    <div class="w-1 h-5 bg-white rounded shadow-lg shadow-white/50"></div>
                                                </div>
                                                <!-- Zone Labels -->
                                                <div class="flex justify-between text-[8px] text-gray-600 mt-1">
                                                    <span>0</span>
                                                    <span class="text-blue-500">30</span>
                                                    <span class="text-gray-400">50</span>
                                                    <span class="text-red-500">70</span>
                                                    <span>100</span>
                                                </div>
                                            </div>
                                            <div class="text-center mt-2">
                                                <span class="text-2xl font-bold ${rsiColor}">${rsi.value}</span>
                                            </div>
                                        </div>
                                    `;

                    // 3. Volume
                    const vol = ta.volume || { pct_change: 0, status: 'normal' };
                    const volIcon = vol.pct_change >= 0 ? 'üìà' : 'üìâ';
                    const volColor = vol.pct_change >= 50 ? 'text-green-400' :
                        vol.pct_change >= 0 ? 'text-blue-400' :
                            vol.pct_change >= -30 ? 'text-gray-400' : 'text-red-400';
                    const volSign = vol.pct_change >= 0 ? '+' : '';

                    html += `
                                        <div class="bg-[#1e1e24] rounded-lg p-3 border border-gray-700">
                                            <div class="text-[10px] text-gray-500 uppercase tracking-wider mb-1">Í±∞ÎûòÎüâ <span class="normal-case">(Ï†ÑÏùº)</span></div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-lg">${volIcon}</span>
                                                <div class="${volColor} text-sm font-bold">ÌèâÍ∑† ÎåÄÎπÑ ${volSign}${vol.pct_change}%</div>
                                            </div>
                                        </div>
                                    `;

                    return html;
                })()}
                            </div>
                        </div>



                        <div class="bg-[#23232a] rounded-xl border border-gray-800 p-5">
                            <h4 class="text-gray-400 text-xs font-bold uppercase mb-4">Í¥ÄÎ†®Ï£º TOP 3</h4>
                            <div class="space-y-3">
                                ${(data.related_peers || []).map(p => {
                    const peerData = allData.find(d => d.ticker === p.ticker) || { name: p.ticker };
                    // SEO ÏàòÏ†ï: onclick -> a href
                    return `
                                        <a href="/stock/${p.ticker}" class="flex justify-between items-center border-b border-gray-800 pb-2 cursor-pointer hover:bg-gray-800 transition p-2 rounded group block text-inherit hover:no-underline">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded flex items-center justify-center p-0.5 shrink-0 overflow-hidden">
                                                    <img src="https://financialmodelingprep.com/image-stock/${p.ticker.replace('.', '-')}.png" 
                                                         alt="${p.ticker} Í¥ÄÎ†®Ï£º"
                                                         onerror="this.src='https://ui-avatars.com/api/?name=${p.ticker}&background=5383e8&color=fff&size=128'" 
                                                         style="filter: invert(1) hue-rotate(180deg);" class="w-full h-full object-contain">
                                                </div>
                                                <div>
                                                    <div class="font-bold text-gray-200 text-sm group-hover:text-blue-400 transition">${peerData.name}</div>
                                                    <div class="text-xs text-gray-500 font-medium">${p.ticker}</div>
                                                </div>
                                            </div>
                                            <span class="${p.change_pct >= 0 ? 'text-red-400' : 'text-blue-400'} font-mono text-sm font-bold bg-[#1c1c1f] px-2 py-1 rounded">${p.change_pct > 0 ? '+' : ''}${p.change_pct}%</span>
                                        </a>
                                    `;
                }).join('')}
                                ${(data.related_peers || []).length === 0 ? '<div class="text-xs text-gray-600">No peers found</div>' : ''}
                            </div>
                        </div>

                    </div>
                </div>
            `;

            document.getElementById('mainContent').innerHTML = html;

            // Initialize TradingView Widget
            if (window.TradingView) {
                new TradingView.widget({
                    "autosize": true,
                    "symbol": (data.exchange ? data.exchange + ":" : "") + data.ticker,
                    "interval": "D",
                    "timezone": "Etc/UTC",
                    "theme": "dark",
                    "style": "1",
                    "locale": "en",
                    "enable_publishing": false,
                    "allow_symbol_change": true,
                    "container_id": "tv_chart_container",
                    "studies": ["BB@tv-basicstudies"]
                });
            }
        }

        function initHeaderSearch() {
            const input = document.getElementById('headerSearch');
            const resultsDiv = document.getElementById('headerSearchResults');

            input.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                if (!term) {
                    resultsDiv.classList.add('hidden');
                    return;
                }

                const matches = allData.filter(d =>
                    d.ticker.toLowerCase().includes(term) ||
                    (d.name && d.name.toLowerCase().includes(term)) ||
                    (d.name_en && d.name_en.toLowerCase().includes(term))
                ).slice(0, 5);

                if (matches.length > 0) {
                    // SEO ÏàòÏ†ï: div onclick -> a href
                    resultsDiv.innerHTML = matches.map(d => `
                        <a href="/stock/${d.ticker}" class="p-2 hover:bg-[#3e63b0] cursor-pointer border-b border-gray-700 last:border-0 flex justify-between items-center block text-inherit hover:no-underline">
                            <div>
                                <span class="font-bold text-xs text-white">${d.ticker}</span>
                                <span class="text-[10px] text-gray-400 ml-1">${d.name}</span>
                            </div>
                            <span class="text-[#5383e8] text-[10px] font-bold">${d.final_score}</span>
                        </a>
                    `).join('');
                    resultsDiv.classList.remove('hidden');
                } else {
                    resultsDiv.innerHTML = '<div class="p-2 text-gray-500 text-[10px]">Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå</div>';
                    resultsDiv.classList.remove('hidden');
                }
            });

            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !resultsDiv.contains(e.target)) {
                    resultsDiv.classList.add('hidden');
                }
            });
        }

        init();
    </script>
</body>

</html>